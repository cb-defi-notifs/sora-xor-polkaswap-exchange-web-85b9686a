"use strict";(self.webpackChunkpolkaswap_exchange_web=self.webpackChunkpolkaswap_exchange_web||[]).push([[157],{90157:function(e,t,a){a.r(t),a.d(t,{default:function(){return x}});var s=a(77057),o=a(70655),r=a(53545),l=a(36930),i=a(8755),n=a(63637),c=a(73331),d=a(32806),p=a(32836),u=a(44973),m=a(52859),b=a(80710),g=a(16546),h=a(85530);const f=(e,t)=>[e,t].join(";");let y=class extends((0,r.Wr)(d.Z,p.Z,c.Z)){constructor(...e){super(...e),(0,s.Z)(this,"order",n.Sr.DESC),(0,s.Z)(this,"property","apr"),(0,s.Z)(this,"poolsData",{})}async updatePoolsData(){await this.updateExploreData()}get list(){return Object.values(this.pools).map((e=>Object.values(e))).flat(2).filter((e=>!e.isRemoved))}get selectedDerivedPool(){return this.selectedPool?this.prepareDerivedPoolData(this.selectedPool,this.selectedAccountPool,this.liquidity):null}get items(){return this.list.map((e=>{const t=this.demeterAssetsData[e.baseAsset],a=this.demeterAssetsData[e.poolAsset],s=this.demeterAssetsData[e.rewardAsset],o=s?.symbol??"",r=l.FPNumber.fromCodecValue(this.getAssetFiatPrice({address:e.rewardAsset})??0),i=this.tokenInfos[e.rewardAsset],n=this.getAccountPool(e),c=!!n&&this.isActiveAccountPool(n),d=this.poolsData[f(e.baseAsset,e.poolAsset)],p=d?.price??l.FPNumber.ZERO,u=d?.reserves?.[0]??l.FPNumber.ZERO,m=d?.reserves?.[1]??l.FPNumber.ZERO,b=d?.supply??l.FPNumber.ZERO,g=n?.pooledTokens??l.FPNumber.ZERO,y=e.isFarm?{address:d?.address??"",balance:b.toCodecString(),firstAddress:t.address??"",firstBalance:u.toCodecString(),secondAddress:a?.address??"",secondBalance:m.toCodecString(),poolShare:"1",reserveA:"1",reserveB:"1",totalSupply:"1"}:null,v=e.isFarm?[t,a]:[a],x=v.map((e=>e?.symbol??"")).join("-"),_=e.isFarm?"":a?.name??"",w=new l.FPNumber(e.depositFee??0).mul(l.FPNumber.HUNDRED),k=p.mul(e.totalTokensInPool),C=this.getEmission(e,i),P=this.getApr(C,k,r),A=(e.isFarm?[{asset:t,balance:b.isZero()?l.FPNumber.ZERO:u.mul(g).div(b)},{asset:a,balance:b.isZero()?l.FPNumber.ZERO:m.mul(g).div(b)}]:[{asset:a,balance:g}]).map((e=>({...e,balance:(0,h.Gc)(e.balance),balancePrefix:e.balance.isZero()?"":"~"})));return{assets:v,name:x,description:_,baseAsset:t,poolAsset:a,rewardAsset:s,rewardAssetSymbol:o,depositFee:w.toNumber(),depositFeeFormatted:(0,h.Gc)(w,!0),tvl:k.toNumber(),tvlFormatted:(0,h.kF)(k),apr:P.toNumber(),aprFormatted:(0,h.Gc)(P,!0),isAccountItem:c,accountTokens:A,liquidity:y}}))}get preparedItems(){return this.isAccountItems?this.items.filter((e=>e.isAccountItem)):this.items}async updateExploreData(){this.loading||await this.withLoading((async()=>{await this.withParentLoading((async()=>{const e={},t=this.isFarmingPage,a=this.list.map((e=>f(e.baseAsset,e.poolAsset))),s=[...new Set(a)];await Promise.allSettled(s.map((async a=>{if(!e[a]){const s=await this.getPoolData(a,t);s&&(e[a]=s)}}))),this.poolsData=Object.freeze(e)}))}))}async getPoolData(e,t){const[a,s]=e.split(";"),o=l.FPNumber.fromCodecValue(this.getAssetFiatPrice({address:s})??0);if(t){const e=i.hi.poolXyk.getInfo(a,s);if(!e)return null;const t=e.address,r=await i.hi.api.query.poolXYK.totalIssuances(e.address),n=r.isEmpty?l.FPNumber.ZERO:new l.FPNumber(r),c=(await i.hi.poolXyk.getReserves(a,s)).map((e=>l.FPNumber.fromCodecValue(e))),d=c[1];return{price:n.isZero()?l.FPNumber.ZERO:d.mul(o).mul(new l.FPNumber(2)).div(n),supply:n,reserves:c,address:t}}return{price:o}}};(0,o.__decorate)([(0,r.RL)("pools",{deep:!0})],y.prototype,"updatePoolsData",null),y=(0,o.__decorate)([(0,r.wA)({components:{CalculatorButton:(0,u.w)(m.J.CalculatorButton),CalculatorDialog:(0,u.w)(m.J.CalculatorDialog),PairTokenLogo:(0,b.kF)(g.z8.PairTokenLogo),SortButton:(0,b.kF)(g.z8.SortButton),TokenLogo:i.wx.TokenLogo,FormattedAmount:i.wx.FormattedAmount,HistoryPagination:i.wx.HistoryPagination}})],y);var v=y,x=(0,a(1001).Z)(v,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("s-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingState,expression:"loadingState"}],ref:"table",staticClass:"explore-table",attrs:{data:e.tableItems,"highlight-current-row":!1,size:"small"}},[a("s-table-column",{attrs:{width:"240",label:"#","fixed-position":"left"},scopedSlots:e._u([{key:"header",fn:function(){return[a("div",{staticClass:"explore-table-item-index"},[a("span",{class:["explore-table-item-index--head",{active:e.isDefaultSort}],on:{click:e.handleResetSort}},[e._v(" # ")])]),a("div",{staticClass:"explore-table-item-logo"},[a("s-icon",{staticClass:"explore-table-item-logo--head",attrs:{name:"various-bone-24",size:"14px"}})],1),a("div",{staticClass:"explore-table-item-info explore-table-item-info--head"},[a("span",{staticClass:"explore-table__primary"},[e._v(e._s(e.t("nameText")))])])]},proxy:!0},{key:"default",fn:function(t){var s=t.$index,o=t.row;return[a("span",{staticClass:"explore-table-item-index explore-table-item-index--body"},[e._v(e._s(s+e.startIndex+1))]),1===o.assets.length?a("token-logo",{key:"token",staticClass:"explore-table-item-logo",attrs:{token:o.assets[0]}}):a("pair-token-logo",{key:"pair",staticClass:"explore-table-item-logo",attrs:{"first-token":o.assets[0],"second-token":o.assets[1],size:"small"}}),a("div",{staticClass:"explore-table-item-info explore-table-item-info--body"},[a("div",{staticClass:"explore-table-item-name"},[e._v(e._s(o.name))]),o.description?a("div",{key:"description",staticClass:"explore-table__secondary"},[e._v(e._s(o.description))]):e._e()])]}}])}),a("s-table-column",{attrs:{width:"120","header-align":"left",align:"left"},scopedSlots:e._u([{key:"header",fn:function(){return[a("sort-button",{attrs:{name:"rewardAssetSymbol",sort:{order:e.order,property:e.property}},on:{"change-sort":e.changeSort}},[a("span",{staticClass:"explore-table__primary"},[e._v("Reward")])])]},proxy:!0},{key:"default",fn:function(t){var s=t.row;return[a("div",{staticClass:"explore-table-cell"},[a("token-logo",{staticClass:"explore-table-item-logo explore-table-item-logo--plain",attrs:{size:"small","token-symbol":s.rewardAsset.symbol}}),a("div",{staticClass:"explore-table-item-name"},[e._v(e._s(s.rewardAsset.symbol))])],1)]}}])}),a("s-table-column",{attrs:{width:"140","header-align":"right",align:"right"},scopedSlots:e._u([{key:"header",fn:function(){return[a("sort-button",{attrs:{name:"apr",sort:{order:e.order,property:e.property}},on:{"change-sort":e.changeSort}},[a("span",{staticClass:"explore-table__primary"},[e._v(e._s(e.TranslationConsts.APR))])])]},proxy:!0},{key:"default",fn:function(t){var s=t.row;return[a("span",{staticClass:"explore-table__accent"},[e._v(e._s(s.aprFormatted))]),a("calculator-button",{nativeOn:{click:function(t){return e.showPoolCalculator({baseAsset:s.baseAsset.address,poolAsset:s.poolAsset.address,rewardAsset:s.rewardAsset.address,liquidity:s.liquidity})}}})]}}])}),a("s-table-column",{attrs:{width:"80","header-align":"right",align:"right"},scopedSlots:e._u([{key:"header",fn:function(){return[a("sort-button",{attrs:{name:"depositFee",sort:{order:e.order,property:e.property}},on:{"change-sort":e.changeSort}},[a("span",{staticClass:"explore-table__primary"},[e._v("Fee")])])]},proxy:!0},{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.depositFeeFormatted)+" ")]}}])}),e.isLoggedIn?a("s-table-column",{key:"logged",attrs:{width:"140","header-align":"right",align:"right"},scopedSlots:e._u([{key:"header",fn:function(){return[a("span",{staticClass:"explore-table__primary"},[e._v(e._s(e.t("balanceText")))])]},proxy:!0},{key:"default",fn:function(t){var s=t.row;return[a("div",{staticClass:"explore-table-item-tokens"},e._l(s.accountTokens,(function(t,s){var o=t.asset,r=t.balance,l=t.balancePrefix;return a("div",{key:s,staticClass:"explore-table-cell"},[a("formatted-amount",{staticClass:"explore-table-item-price explore-table-item-amount",attrs:{"value-can-be-hidden":"","font-size-rate":e.FontSizeRate.SMALL,value:r},scopedSlots:e._u([{key:"prefix",fn:function(){return[e._v(e._s(l))]},proxy:!0}],null,!0)}),a("token-logo",{staticClass:"explore-table-item-logo explore-table-item-logo--plain",attrs:{size:"small",token:o}})],1)})),0)]}}],null,!1,596145239)}):e._e(),a("s-table-column",{attrs:{width:"104","header-align":"right",align:"right"},scopedSlots:e._u([{key:"header",fn:function(){return[a("sort-button",{attrs:{name:"tvl",sort:{order:e.order,property:e.property}},on:{"change-sort":e.changeSort}},[a("span",{staticClass:"explore-table__primary"},[e._v(e._s(e.TranslationConsts.TVL))]),a("s-tooltip",{attrs:{"border-radius":"mini",content:e.t("tooltips.tvl")}},[a("s-icon",{attrs:{name:"info-16",size:"14px"}})],1)],1)]},proxy:!0},{key:"default",fn:function(t){var s=t.row;return[a("formatted-amount",{staticClass:"explore-table-item-price explore-table-item-amount",attrs:{"is-fiat-value":"","font-weight-rate":e.FontWeightRate.MEDIUM,value:s.tvlFormatted.amount}},[e._v(" "+e._s(s.tvlFormatted.suffix)+" ")])]}}])})],1),a("history-pagination",{staticClass:"explore-table-pagination",attrs:{"current-page":e.currentPage,"page-amount":e.pageAmount,total:e.total,"last-page":e.lastPage,loading:e.loadingState},on:{"pagination-click":e.handlePaginationClick}}),a("calculator-dialog",e._b({attrs:{visible:e.showCalculatorDialog,liquidity:e.liquidity},on:{"update:visible":function(t){e.showCalculatorDialog=t}}},"calculator-dialog",e.selectedDerivedPool,!1))],1)}),[],!1,null,null,null).exports}}]);