"use strict";(self.webpackChunkpolkaswap_exchange_web=self.webpackChunkpolkaswap_exchange_web||[]).push([[6267],{6267:function(t,e,a){a.r(e),a.d(e,{default:function(){return b}});var i=a(77057),o=a(70655),s=a(53545),n=a(8755),r=a(2054),c=a(34886),d=a(63471),h=a(85530),l=a(16546),u=a(80710),m=a(82344),y=a(74614),p=a(25108);const g="history";let w=class extends((0,s.Wr)(n.tA.PaginationSearchMixin,r.Z)){constructor(...t){super(...t),(0,i.Z)(this,"FontSizeRate",n.it.FontSizeRate),(0,i.Z)(this,"transactions",void 0),(0,i.Z)(this,"currencies",void 0),(0,i.Z)(this,"isValidNetworkType",void 0),(0,i.Z)(this,"libraryTheme",void 0),(0,i.Z)(this,"getTransactions",void 0),(0,i.Z)(this,"getCurrencies",void 0),(0,i.Z)(this,"unwatchEthereum",void 0),(0,i.Z)(this,"pageAmount",5),(0,i.Z)(this,"currentView",g),(0,i.Z)(this,"selectedItem",{})}created(){this.withApi((async()=>{this.initMoonpayApi(),await Promise.all([this.getTransactions(),this.getCurrencies()]),this.setHistory(),this.unwatchEthereum=await d.ZP.watchEthereum({onAccountChange:t=>{t.length?this.changeExternalWallet({address:t[0]}):this.disconnectExternalAccount()},onNetworkChange:t=>{this.setEvmNetworkType(t)},onDisconnect:()=>{this.disconnectExternalAccount()}})}))}beforeDestroy(){"function"==typeof this.unwatchEthereum&&this.unwatchEthereum()}get currenciesById(){return this.currencies.reduce(((t,e)=>({...t,[e.id]:e})),{})}get emptyHistory(){return!this.transactions.length}get total(){return this.transactions.length}get historyItems(){return this.getPageItems(this.transactions)}get formattedItems(){const{currenciesById:t,historyItems:e,formatDate:a}=this,i=e=>(t[e]?.code??"").toUpperCase(),o=t=>Number.isFinite(t)?String(t):t;return e.map((t=>{return{...t,formatted:{fiat:i(t.baseCurrencyId),fiatAmount:o(t.baseCurrencyAmount),crypto:i(t.currencyId),cryptoAmount:o(t.quoteCurrencyAmount),date:a(new Date(t.updatedAt).getTime()),icon:(e=t.status,e===m.D.Completed?"basic-check-mark-24":e===m.D.Failed?"basic-clear-X-24":"basic-more-horizontal-24")}};var e}))}get detailsWidgetUrl(){if(!this.selectedItem.id)return"";const t=(0,h.UK)({colorCode:(0,h.y_)("--s-color-theme-accent"),language:this.language,transactionId:this.selectedItem.id});return`${this.selectedItem.returnUrl}?${t}`}get bridgeTxToSora(){if(this.selectedItem.id)return this.getBridgeHistoryItemByMoonpayId(this.selectedItem.id)}get isCompletedTransaction(){return this.selectedItem?.status===m.D.Completed}get externalAccountIsMoonpayRecipient(){return this.selectedItem?.walletAddress?.toLowerCase?.()===this.evmAddress.toLowerCase()}get actionButtonType(){return this.bridgeTxToSora?"secondary":"primary"}get actionButtonDisabled(){return!this.bridgeTxToSora&&(!this.externalAccountIsMoonpayRecipient||!this.isValidNetworkType)}get actionButtonText(){return this.isExternalAccountConnected?this.bridgeTxToSora?this.t("moonpay.buttons.view"):this.externalAccountIsMoonpayRecipient?this.isValidNetworkType?this.t("moonpay.buttons.transfer"):this.t("bridgeTransaction.changeNetwork"):this.t("bridgeTransaction.changeAccount"):this.t("connectWalletText")}get isHistoryView(){return this.currentView===g}changeView(t){this.currentView=t}async handlePaginationClick(t){let e=1;switch(t){case n.it.PaginationButton.Prev:e=this.currentPage-1;break;case n.it.PaginationButton.Next:e=this.currentPage+1,e===this.lastPage&&(this.isLtrDirection=!1);break;case n.it.PaginationButton.First:this.isLtrDirection=!0;break;case n.it.PaginationButton.Last:e=this.lastPage,this.isLtrDirection=!1}this.currentPage=e}handleBack(){this.loading=!1,this.changeView(g)}async navigateToDetails(t){try{await this.checkConnectionToExternalAccount((async()=>{await this.prepareEvmNetwork(),this.selectedItem=t,this.changeView("details")}))}catch(t){p.error(t)}}async handleTransaction(){this.selectedItem.id&&(this.bridgeTxToSora?.id?(await this.prepareEvmNetwork(this.bridgeTxToSora.externalNetwork),await this.showHistory(this.bridgeTxToSora.id)):await this.prepareMoonpayTxForBridgeTransfer(this.selectedItem))}};(0,o.__decorate)([y.SB.moonpay.transactions],w.prototype,"transactions",void 0),(0,o.__decorate)([y.SB.moonpay.currencies],w.prototype,"currencies",void 0),(0,o.__decorate)([y.Yn.web3.isValidNetworkType],w.prototype,"isValidNetworkType",void 0),(0,o.__decorate)([y.Yn.libraryTheme],w.prototype,"libraryTheme",void 0),(0,o.__decorate)([y.aD.moonpay.getTransactions],w.prototype,"getTransactions",void 0),(0,o.__decorate)([y.aD.moonpay.getCurrencies],w.prototype,"getCurrencies",void 0),w=(0,o.__decorate)([(0,s.wA)({components:{MoonpayLogo:c.default,FormattedAmount:n.wx.FormattedAmount,GenericPageHeader:(0,u.kF)(l.z8.GenericPageHeader),Widget:(0,u.kF)(l.z8.Widget),HistoryPagination:n.wx.HistoryPagination}})],w);var v=w,b=(0,a(1001).Z)(v,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.parentLoading,expression:"parentLoading"}],staticClass:"container"},[a("generic-page-header",{staticClass:"page-header-title--moonpay-history",attrs:{"has-button-back":!t.isHistoryView},on:{back:t.handleBack}},[a("moonpay-logo",{attrs:{slot:"title",theme:t.libraryTheme},slot:"title"})],1),a("div",{staticClass:"moonpay-history"},[t.isHistoryView?[a("div",{staticClass:"moonpay-history-title"},[t._v(t._s(t.t("moonpay.history.title")))]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],class:["moonpay-history-list",{empty:t.emptyHistory}]},[t._l(t.formattedItems,(function(e){return a("div",{directives:[{name:"button",rawName:"v-button"}],key:e.id,staticClass:"moonpay-history-item",attrs:{tabindex:"0"},on:{click:function(a){return t.navigateToDetails(e)}}},[a("div",{staticClass:"moonpay-history-item-data"},[a("div",{staticClass:"moonpay-history-item__date"},[t._v(t._s(e.formatted.date))]),a("div",{staticClass:"moonpay-history-item__amount"},[e.formatted.cryptoAmount?[a("formatted-amount",{staticClass:"moonpay-history-item-amount",attrs:{"value-can-be-hidden":"",value:e.formatted.cryptoAmount,"font-size-rate":t.FontSizeRate.MEDIUM,"asset-symbol":e.formatted.crypto}}),a("i",{staticClass:"s-icon--network s-icon-eth"}),t._v("  "),a("span",[t._v(t._s(t.t("forText")))]),t._v("   ")]:t._e(),a("formatted-amount",{staticClass:"moonpay-history-item-amount",attrs:{"value-can-be-hidden":"",value:e.formatted.fiatAmount,"font-size-rate":t.FontSizeRate.MEDIUM,"asset-symbol":e.formatted.fiat}})],2),a("div",{staticClass:"moonpay-history-item__wallet-address"},[t._v(" "+t._s(e.walletAddress)+" ")])]),a("s-icon",{class:["moonpay-history-item-icon",e.status],attrs:{name:e.formatted.icon,size:"14"}})],1)})),t.emptyHistory?a("span",[t._v(t._s(t.t("moonpay.history.empty")))]):t._e()],2),t.emptyHistory?t._e():a("history-pagination",{staticClass:"moonpay-history-pagination",attrs:{"current-page":t.currentPage,"page-amount":t.pageAmount,total:t.total,loading:t.loading,"last-page":t.lastPage},on:{"pagination-click":t.handlePaginationClick}})]:[a("widget",{attrs:{src:t.detailsWidgetUrl}}),t.isCompletedTransaction?a("s-button",{staticClass:"moonpay-details-button s-typography-button--large",attrs:{type:t.actionButtonType,disabled:t.actionButtonDisabled,loading:t.loading},on:{click:t.handleTransaction}},[t._v(" "+t._s(t.actionButtonText)+" ")]):t._e()]],2)],1)}),[],!1,null,"261f79fe",null).exports}}]);